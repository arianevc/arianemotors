<%- include('../partials/admin/header.ejs') %>

<main class="main">
    <section class="content-main">
        
        <div class="content-header">
            <div>
                <h2 class="content-title">Order Details</h2>
                <p><strong>Order ID:</strong> <%= order.orderId %></p>
                <p><strong>Date:</strong> <%= new Date(order.createdAt).toLocaleDateString() %></p>
            </div>
            <div>
                <a href="/admin/orders" class="btn btn-light rounded">&larr; Back to Orders</a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 col-lg-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Customer & Shipping</h4>
                    </div>
                    <div class="card-body">
                        <p><strong>Customer:</strong> <%= order.userId.name %></p>
                        <p><strong>Email:</strong> <%= order.userId.email %></p>
                        <hr>
                        <strong>Shipping Address:</strong>
                        <address>
                            <%= order.shippingAddress.name %><br>
                            <%= order.shippingAddress.street %><br>
                            <%= order.shippingAddress.city %>, <%= order.shippingAddress.state %> - <%= order.shippingAddress.pincode %><br>
                            Phone: <%= order.shippingAddress.phone %>
                        </address>
                    </div>
                </div>
            </div>

            <div class="col-md-6 col-lg-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Payment & Status</h4>
                    </div>
                    <div class="card-body">
                        <p><strong>Payment Method:</strong> <%= order.paymentMethod %></p>
                        <p><strong>Payment Status:</strong> <%= order.paymentStatus %></p>
                        <p><strong>Payment ID:</strong> <%= order.paymentId %></p>
                        <hr>
                        <p><strong>Order Status:</strong> <span class="badge bg-primary"><%= order.orderStatus %></span></p>
                        <p><strong>Total Price:</strong> <span class="h5">₹<%= order.totalPrice.toFixed(2) %></span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h4>Items in Order (<%= order.items.length %>)</h4>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th width="40%">Product</th>
                                <th width="20%">Unit Price</th>
                                <th width="20%">Quantity</th>
                                <th width="20%" class="text-end">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% order.items.forEach(item => { %>
                                <tr>
                                    <td>
                                        <% if (item.productId) { %>
                                            <img src="<%= item.productId.images[0] %>" width="40" class="img-xs">
                                            <span><%= item.productId.name %></span>
                                        <% } else { %>
                                            <span>Product (Deleted)</span>
                                        <% } %>
                                    </td>
                                    <td>₹<%= item.price.toFixed(2) %></td>
                                    <td><%= item.quantity %></td>
                                    <td class="text-end">₹<%= (item.price * item.quantity).toFixed(2) %></td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </section>
</main>

 <script src="/backend/assets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/backend/assets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/backend/assets/js/vendors/select2.min.js"></script>
    <script src="/backend/assets/js/vendors/perfect-scrollbar.js"></script>
    <script src="/backend/assets/js/vendors/jquery.fullscreen.min.js"></script>
    <script src="/backend/assets/js/vendors/chart.js"></script>
    <!-- Main Script -->
    <script src="/backend/assets/js/main.js" type="text/javascript"></script>
    <script src="/backend/assets/js/custom-chart.js" type="text/javascript"></script>
</body>

</html>