<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <title>Ariane Motors-EV franchise</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/frontend/assets/imgs/theme/am_logo_tiny.png">
    <!-- Template CSS -->
    <link rel="stylesheet" href="/frontend/assets/css/main.css?v=3.4">
    <!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!--Fa icon cdn-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
   
    
</head>

<body>
<style>
    .error-message{
        display: none;
        color: red;
        font-size: small;
    }
    .pwdtogglebutton{
        border: none;
        background-color: white;
    }
    
</style>
<header class="header-area header-style-1 header-height-2">
    
</header>
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container d-flex justify-content-between">
                <div class="breadcrumb">
                    <a href="/" rel="nofollow">Home</a>
                    <span> Create Account</span>
                </div>
                <div class="logo">
                    <a href="/"><img src="/frontend/assets/imgs/theme/am_logo.png" height="50px" alt="logo"></a>
                </div>
            </div>
        </div>
        <section class="pt-150 pb-150">
            
                    <div class="col-lg-10 m-auto">
                        <div class="row d-flex justify-content-center">
                           
                            <% if(message) {%>
                            <script>
                                
                                Swal.fire({
                                title: "Error!",
                                text: "<%= message%>",
                                icon: "error"
                              });
                            </script>
                            <% } %>
                         
                            <div class="col-lg-6 d-flex justify-content-center">
                                <div class="login_wrap widget-taber-content p-30 background-white border-radius-5">
                                    <div class="padding_eight_all bg-white">
                                        <div class="heading_s1">
                                            <h3 class="mb-30">Create an Account</h3>
                                        </div>
                                        <p class="mb-50 font-sm">
                                            Your personal data will be used to support your experience throughout this website, to manage access to your account, and for other purposes described in our privacy policy
                                        </p>
                                        <form id="formsignup">
                                            <div class="form-group">
                                                <input type="text" required="" id="name" name="name" placeholder="Name">
                                                
                                            </div>
                                            <div class="form-group">
                                                <input type="email" required="" id="email" name="email" placeholder="Email">
                                                
                                            </div>
                                            <div class="form-group">
                                                <input type="text" required="" id="phone" name="phone" placeholder="Phone">
                                                
                                            </div>
        
                                            <div class="form-group">
                                                <div class="pwd-grp d-flex">
                                                <input class="loginpassword" required="" id="password" type="password" name="password" placeholder="Password">
                                                <button type="button" class="pwdtogglebutton"><i class="fa fa-eye"></i></button>
                                                </div>
                                                
                                            </div>
                    
                                            <div class="form-group">
                                                <input required="" id="cpassword" type="password" name="cpassword" placeholder="Confirm password">
                                               
                                            </div>
                                           
                                                <div class="error-messages">
                                                    <p class="text-danger" hidden></p>
                                                </div>
                                            <div class="form-group d-flex justify-content-center">
                                                <button type="submit" id="submitBtnSignup" class="btn btn-fill-out btn-block hover-up" name="login">Submit &amp; Register</button>
                                            </div>
                                        </form>
                                        <div  id="spinner" role="status">
                                    <span class="sr-only">Loading...</span>
                                         </div>
                                        <div class="divider-text-center mt-15 mb-15">
                                            <span> or</span>
                                        </div>
                                        <ul class="btn-login list_none text-center mb-15">

                                            <li><a href="/auth/google" class="btn btn-google hover-up">Signup With Google</a></li>
                                        </ul>
                                        <div class="text-muted text-center">Already have an account? <a href="/login">Sign in now</a></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                
            
        </section>
    </main>
   <%- include('../partials/user/footer') %>
    <script>
        
        document.addEventListener('DOMContentLoaded',function(){
            const errorContainer=document.querySelector('.error-messages')
            //eye button for password toggle
            const toggleButtons=document.querySelectorAll(".pwdtogglebutton")
            
            toggleButtons.forEach(button=>{
                button.addEventListener("click",()=>{
                    const passwordInput=button.previousElementSibling
                const icon=button.querySelector("i")
            const isPassword=passwordInput.type==="password"
            passwordInput.type=isPassword?"text":"password"

            icon.classList.toggle("fa-eye-slash",isPassword)
            icon.classList.toggle("fa-eye",!isPassword)
            })
            })

            //signup form submission
            const signupForm=document.getElementById('formsignup')
            
            signupForm.addEventListener('submit',async function(e){
                e.preventDefault()
                errorContainer.innerHTML=''
                const formData=new FormData(signupForm)
            const data={
                name:signupForm.name.value,
                email:signupForm.email.value,
                phone:signupForm.phone.value,
                password:signupForm.password.value,
                cpassword:signupForm.cpassword.value
            }
           try {
             const response=await fetch('/signup',{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify(data)
            })
            const result=await response.json()
            if(result.errors){
                result.errors.forEach((err)=>{
                    const p=document.createElement("p")
                    p.classList.add('text-danger')
                    p.innerText=err.msg
                    errorContainer.appendChild(p)
                })
            }else if(result.important){
                Swal.fire({
                    icon:'error',
                    title:'Error!',
                    text:result.message,
                    timer:2000,
                    showConfirmButton:false
                })
            }else if(result.success){
                Swal.fire({
                    icon:'error',
                    title:'Error!',
                    text:result.message,
                    timer:2000,
                    showConfirmButton:false
                }).then(()=>{
                    window.location.href='/verify-otp'
                })
            }
           } catch (error) {
            console.error("error in registering user: ",error);
            Swal.fire('Error!','Unable to register user','error')
           }
            })
        })

    </script>
</body>

</html>