
<%- include('../partials/user/header') %>
   
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="/" rel="nofollow">Home</a>
                    <span></span> <%= product.category.name %>
                    <span></span> <%= product.name %>
                </div>
            </div>
        </div>
        <section class="product_container">
            <div class="product_details_main d-flex justify-content-center p-5">
                                <div class="product_images p-4">
                                    <div class="detail-gallery">
                                        <span class="zoom-icon"><i class="fi-rs-search"></i></span>
                                        <!-- MAIN SLIDES -->
                                        <div class="product-image-slider">
                                            <% if(product.images&&product.images.length>0){ %>
                                            <div class="border-radius-10">
                                                <img src="<%= product.images[0] %>" id="product-img" data-zoom-image="<%=product.images[0] %>"   alt="product image">
                                            </div>
                                            <% }else{ %>
                                                <figure class="border-radius-10">
                                                <img src="/images/defaultImage.jpg"alt="product image">
                                            </figure>
                                            <% } %>
                                        </div>
                                        <!-- THUMBNAILS -->
                                        <div class="slider-nav-thumbnails p-3" id="gal1">
                                            <% product.images.forEach(image => { %>
                                                <a data-image="<%= image %>" class="thumbnail_img p-1" data-zoom-image="<%= image %>">

                                                        <img src="<%= image %>" alt="product image thumbnail" width="75" height="75">

                                                    </a>
                                                <% }) %>
                                               </div>
                                    </div>
                                    <!-- End Gallery -->
                                    <div class="social-icons single-share">
                                        <ul class="text-grey-5 d-inline-block">
                                            <li><strong class="mr-10">Share this:</strong></li>
                                            <li class="social-facebook"><a href="#"><img src="/frontend/assets/imgs/theme/icons/icon-facebook.svg" alt=""></a></li>
                                            <li class="social-twitter"> <a href="#"><img src="/frontend/assets/imgs/theme/icons/icon-twitter.svg" alt=""></a></li>
                                            <li class="social-instagram"><a href="#"><img src="/frontend/assets/imgs/theme/icons/icon-instagram.svg" alt=""></a></li>
                                            <li class="social-linkedin"><a href="#"><img src="/frontend/assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="product_details p-4">
                                    <div class="detail-info">
                                        <h2 class="title-detail"><%= product.name %></h2>
                                        <div class="product-detail-rating">
                                            <input type="text" name="isDeleted" id="isDeleted" value="<%=product.isDeleted  %>" hidden>
                                            <div class="pro-details-brand">
                                                <span> Brand: <a href="#"><%= product.brand %></a></span>
                                            </div>
                                            <div class="product-rate-cover text-end">
                                                <div class="product-rate d-inline-block">
                                                    <div class="product-rating" style="width:90%">
                                                    </div>
                                                </div>
                                                <span class="font-small ml-5 text-muted"> (25 reviews)</span>
                                            </div>
                                        </div>
                                        <div class="clearfix product-price-cover">
                                            <div class="product-price primary-color float-left">
                                                <ins><span class="text-brand">₹<%=product.price%>.00</span></ins>
                                                <ins><span class="old-price font-md ml-15">₹<%= (product.price*1.2).toFixed(2) %> </span></ins>
                                                <span class="save-price  font-md color3 ml-15">10% Off</span>
                                            </div>
                                        </div>
                                        <div class="bt-1 border-color-1 mt-15 mb-15"></div>
                                        <div class="short-desc mb-30">
                                            <p><%= product.productDescription %></p>
                                        </div>
                                        <div class="product_sort_info font-xs mb-30">
                                            <ul>
                                                <!-- <li class="mb-10"><i class="fi-rs-crown mr-5"></i> 1 Year AL Jazeera Brand Warranty</li> -->
                                                <li class="mb-10"><i class="fi-rs-refresh mr-5"></i> 30 Day Return Policy</li>
                                                <li><i class="fi-rs-credit-card mr-5"></i> Cash on Delivery available</li>
                                            </ul>
                                        </div>
                                        <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                                        <% if(product.quantity<1||product.quantity==undefined){ %>
                                            <div><h3 style="color: red;">Product is out of stock</h3></div>
                                            <% }else if(product.isDeleted){ %>
                                                <div><h3 style="color: red;">Product is currently unavailable</h3></div>
                                            <% }else{ %>
                                        <div class="detail-extralink">
                                            <div class="detail-qty border radius">
                                                <a href="#" class="qty-down"><i class="fi-rs-angle-small-down"></i></a>
                                                <span class="qty-val" id="qtyValue">1</span>
                                                <a href="#" class="qty-up"><i class="fi-rs-angle-small-up"></i></a>
                                            </div>
                                            <div class="product-extra-link2">
                                                <button type="button" class="button button-add-to-cart" id="addToCartBtn" data-product-id="<%= product._id %>">Add to cart</button>
                                                <% if(isWishlisted){ %>
                                                    <a title="Wishlisted" id="wishlistAddBtn" class="action-btn hover-up" data-product-id="<%= product._id %>"><i class="fa fa-heart" style="color: red;"></i></a>
                                                    <% }else{ %>
                                                <a title="Add To Wishlist" id="wishlistAddBtn" class="action-btn hover-up" data-product-id="<%= product._id %>"><i class="fa fa-heart-o"></i></a>
                                                <% } %>
                                                <!-- <a aria-label="Compare" class="action-btn hover-up" href="shop-compare.html"><i class="fi-rs-shuffle"></i></a> -->
                                            </div>
                                        </div>
                                        <% } %>
                                        <ul class="product-meta font-xs color-grey mt-50">
                                            <li>Availability:<span class="in-stock text-<%= product.quantity<=5?"danger":"success" %> ml-5"><%= product.quantity %> Items In Stock</span></li>
                                        </ul>
                                    </div>
                                    <!-- Detail Info -->
                                </div>
                                </div>
                             <div class="related-products p-4">
                                <div class="col-12">
                                    <h3 class=" style-1 mb-30">Related products</h3>
                                </div>
                                <div class="col-12">
                                    <div class="row related-products">

                                        <!--products-->
                                        <% relatedProducts.forEach((item)=>{ %>
                                        <div class="col-lg-3 col-md-4 col-12 col-sm-6">
                                            <div class="product-cart-wrap small hover-up">
                                                <div class="product-img-action-wrap">
                                                    <div class="product-img product-img-zoom">
                                                        <a href="/shop/product/<%=item._id%>" tabindex="0">
                                                            <img class="default-img" src= <%= item.images[0] %> alt="product_image">
                                                            <img class="hover-img" src="<% item.images[1]?item.images[1]:item.images[0] %>" alt="product_image">
                                                        </a>
                                                    </div>
                                                </div>
                                                <div class="product-content-wrap">
                                                    <h2><a href="/shop/product/<%=item._id%>" tabindex="0"><%= item.name %></a></h2>
                                                    <div class="rating-result" title="90%">
                                                        <span>
                                                        </span>
                                                    </div>
                                                    <div class="product-price">
                                                        <span>₹<%= item.price.toFixed(2) %> </span>
                                                        <span class="old-price">₹<%= (item.price*1.2).toFixed(2) %></span>
                                                    </div>
                                                </div>
                                            
                                        
                                    
                                
                            </div> 
                            
                        </div>
                    
                    <% }) %>
                </div>
            </div>
            </div>
        </section>
    </main>
    
    <!-- Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="text-center">
                    <h5 class="mb-5">Now Loading</h5>
                    <div class="loader">
                        <div class="bar bar1"></div>
                        <div class="bar bar2"></div>
                        <div class="bar bar3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <%-include('../partials/user/footer')%>
    
    <!-- Vendor JS-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/igorlino/elevatezoom-plus/1.1.6/src/jquery.ez-plus.js"></script>
    <script src="/frontend/assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="/frontend/assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="/frontend/assets/js/plugins/slick.js"></script>
    <script src="/frontend/assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="/frontend/assets/js/plugins/wow.js"></script>
    <script src="/frontend/assets/js/plugins/jquery-ui.js"></script>
    <script src="/frontend/assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="/frontend/assets/js/plugins/magnific-popup.js"></script>
    <script src="/frontend/assets/js/plugins/select2.min.js"></script>
    <script src="/frontend/assets/js/plugins/waypoints.js"></script>
    <script src="/frontend/assets/js/plugins/counterup.js"></script>
    <script src="/frontend/assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="/frontend/assets/js/plugins/images-loaded.js"></script>
    <script src="/frontend/assets/js/plugins/isotope.js"></script>
    <script src="/frontend/assets/js/plugins/scrollup.js"></script>
    <script src="/frontend/assets/js/plugins/jquery.vticker-min.js"></script>
    <script src="/frontend/assets/js/plugins/jquery.theia.sticky.js"></script>
    
    <!-- Template  JS -->
    <script src="/frontend/assets/js/main.js?v=3.4"></script>
    
    <!--Zoom function JQuery-->
    <script>
        $(document).ready(function(){
            $('#product-img').ezPlus({
                gallery:'gal1',
                galleryActiveClass:'active',
                easing:true,
                tint: true,
                tintColour: '#121212', 
                tintOpacity: 0.75,
                scrollZoom: true,
                 lensSize: 100,
                imageCrossfade:true
            })
        })
    </script>

<script>
    document.addEventListener('DOMContentLoaded',function(){

        const isDeleted=document.getElementById('isDeleted').value
        console.log("isdeleted value: ",isDeleted)
        if(isDeleted=='true'){
            Swal.fire({
        icon:"error",
        title:"Sorry!",
        text:"Product is currently unavailable",
      }).then(()=>{
        window.location.href='/shop'
      })
        }
        const cartBtn=document.getElementById('addToCartBtn')
        const qtySpan = document.getElementById('qtyValue');
        const qtyUp = document.querySelector('.qty-up');
        const qtyDown = document.querySelector('.qty-down');
        let cartqtyvalue=parseInt(qtySpan.textContent)
         qtyUp.addEventListener('click', function(e) {
         e.preventDefault();
        let currentQty = parseInt(qtySpan.textContent);
         qtySpan.textContent = currentQty + 1;
        cartqtyvalue=parseInt(qtySpan.textContent ) 
    });

       qtyDown.addEventListener('click', function(e) {
        e.preventDefault();
         let currentQty = parseInt(qtySpan.textContent);
    if (currentQty > 1) {
        qtySpan.textContent = currentQty - 1;
        cartqtyvalue=parseInt(qtySpan.textContent)  
    }
  });
  //cart functions
        const productId=cartBtn.dataset.productId
        cartBtn.addEventListener('click',function(e){
            e.preventDefault()
            // console.log("button clicked");
            // console.log("qty value is: ",cartqtyvalue)
            // console.log("product id is: ",productId);
            const cartDetails={
                productId:productId,
                quantity:cartqtyvalue,
            }
            fetch('/shop/cart/add',{
                method:"POST",
                headers:{"Content-Type":'application/json'},
                body:JSON.stringify(cartDetails)
            }).then(response=>response.json())
            .then(result=>{
                if(result.success){
                     Swal.fire({
                        icon:'success',
                        title:'Product added to cart',
                        text:result.message,
                        showCancelButton:true,
                        confirmButtonText:'View Cart'
                    }).then((res)=>{
                        if(res.isConfirmed){
                            location.href='/shop/cart'
                        }
                    })
                }else if(result.redirectUrl){
                    console.log("link: ",result.redirectUrl);
                    Swal.fire({
                        icon:'error',
                        title:'Error',
                        text:result.message,
                        confirmButtonText:'Ok',
                        showCancelButton:true
                    }).then((swalResult)=>{
                        if(swalResult.isConfirmed){
                            window.location.href=result.redirectUrl
                        }
                    })
                }else{
                    Swal.fire("Error", result.message || "Could not add product to cart.", "error")
                }
            })
            
            
        })
        //wishlist functions
        const wishlistBtn=document.getElementById('wishlistAddBtn')
        const productIdwl=wishlistBtn.dataset.productId
        const heartIcon=wishlistBtn.querySelector('i')
        wishlistBtn.addEventListener('click',function(e){
            // console.log("button clicked",productIdwl);
            fetch(`/shop/wishlist/toggle/${productIdwl}`,{
                method:'POST',
                credentials:"include",
                headers:{"Content-Type":"application/json"}
            }).then(response=>response.json())
            .then(result=>{
                if(result.success){
                    Swal.fire({
                        icon:'success',
                        title:result.message,
                        timer:1500,
                        showConfirmButton:false
                    })
                    if(result.removed){
                        heartIcon.classList.remove('fa-heart')
                        heartIcon.classList.add('fa-heart-o')
                        heartIcon.style.color=""
                    }else{
                        heartIcon.classList.remove('fa-heart-o')
                        heartIcon.classList.add('fa-heart')
                        heartIcon.style.color="red"
                    }
                }else{
                    Swal.fire({
                        icon:'error',
                        title:"Error!",
                        text:result.message,
                        showConfirmButton:true,
                        showCancelButton:true
                    }).then((swalResult)=>{
                        if(result.redirectUrl&&swalResult.isConfirmed){
                            window.location.href=result.redirectUrl
                        }
                    })
                }
            }).catch(err=>{
                console.log("error in wishlist: ",err);
                Swal.fire({
                        icon:'error',
                        title:"Error",
                        text:err.message,
                        timer:1500,
                        showConfirmButton:false
                    })
                
            })
            
        })
        
    })
</script>

</body>

</html>